<p *ngIf="mode === 'edit'" class="text-secondary">
    <i class="fa fa-info-circle" aria-hidden="true"></i>
    {{'structuralResourcesTree.helpMessage' | translate}}.
</p>

<p-tree
    (onNodeSelect)="onSelect($event.node)"
    (onNodeUnselect)="onUnselect($event.node)"
    [(selection)]="selectedResources"
    [value]="resources"
    [selectionMode]="selectionMode"
    [emptyMessage]="'structuralResourcesTree.noRecordsFound' | translate"
    [draggableNodes]="enableDragAndDrop"
    [droppableNodes]="enableDragAndDrop"
    [loading]="!resources"
>
    <ng-template *ngIf="mode === 'view'" let-node pTemplate="default">
        <span class="label">{{node.label}}</span>&nbsp;
        <span class="subscribed-users">({{'structuralResourcesTree.subscribedUsers' | translate:{amount: node.data.subscribers || 0} }})</span>
    </ng-template>
    <ng-template *ngIf="mode === 'edit'" let-node pTemplate="default">
        <span class="label mr-2" (dblclick)="editNodeName(node)">{{node.label}}</span>
        <p-dialog
            *ngIf="node.editMode === 'name'"
            [visible]="true"
            [focusOnShow]="true"
            [modal]="true"
            [dismissableMask]="true"
            [header]="'structuralResourcesTree.editionModal' | translate"
            [resizable]="false"
            [style]="{width: '50vw'}"
            [contentStyle]="{padding: '1.5em 2em'}"
            appendTo="body"
            (visibleChange)="disableNodeEdit(node)"
        >
            <app-multi-language-input
                *ngIf="allowedLanguages"
                [ngModel]="node.data.name"
                [locales]="allowedLanguages"
                (onEnterKeyDown)="saveNodeName(node, $event)"
            ></app-multi-language-input>
            <p-footer>
                <button type="button" class="btn btn-secondary" (click)="disableNodeEdit(node)">
                    <i class="fa fa-times" aria-hidden="true"></i>
                    <span>Cancelar</span>
                </button>
                <button type="button" class="btn btn-primary" (click)="saveNodeName(node, languageInputComponent.value)">
                    <i class="fa fa-save" aria-hidden="true"></i>
                    <span>Guardar</span>
                </button>
            </p-footer>
        </p-dialog>
        <p-dialog
            *ngIf="node.editMode === 'remap'"
            [visible]="true"
            [focusOnShow]="true"
            [modal]="true"
            [dismissableMask]="true"
            [header]="'structuralResourcesTree.editionModal' | translate"
            [resizable]="false"
            [style]="{width: '80vw'}"
            [contentStyle]="{padding: '1.5em 2em', overflow: 'visible'}"
            appendTo="body"
            (visibleChange)="disableNodeEdit(node)"
        >
            <app-external-categories-table #table [externalCategories]="externalCategories" [selectedExternalCategories]="node.data.resources"></app-external-categories-table>
            <p-footer>
                <button type="button" class="btn btn-secondary">
                    <i class="fa fa-times" aria-hidden="true"></i>
                    <span>Cancelar</span>
                </button>
                <button type="button" class="btn btn-primary" (click)="saveRemap(node, table.getSelectedResources())">
                    <i class="fa fa-save" aria-hidden="true"></i>
                    <span>Guardar</span>
                </button>
            </p-footer>
        </p-dialog>
        <button type="button" class="btn btn-info node-btn-sm mr-2">
            <i class="fa fa-search" aria-hidden="true" (click)="remapNode(node)"></i>
        </button>
        <button type="button" class="btn btn-primary node-btn-sm mr-2" (click)="addNode(node)">
            <i class="fa fa-plus" aria-hidden="true"></i>
        </button>
        <button type="button" class="btn btn-danger node-btn-sm" (click)="deleteNode(node)">
            <i class="fa fa-minus" aria-hidden="true"></i>
        </button>
    </ng-template>
</p-tree>
